import{l as h,e as S,M as v,aC as _,aD as C,a0 as T}from"./BVWwdZHL.js";import{w as d,g as s}from"./C-A09_gl.js";function y(e,t,a=!1){if(e.multiple){if(t==null)return;if(!v(t))return _();for(var n of e.options)n.selected=t.includes(f(n));return}for(n of e.options){var o=f(n);if(C(o,t)){n.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function O(e){var t=new MutationObserver(()=>{y(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),T(()=>{t.disconnect()})}function N(e,t,a=t){var n=!0;h(e,"change",o=>{var r=o?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(r),f);else{var g=e.querySelector(r)??e.querySelector("option:not([disabled])");l=g&&f(g)}a(l)}),S(()=>{var o=t();if(y(e,o,n),n&&o===void 0){var r=e.querySelector(":checked");r!==null&&(o=f(r),a(o))}e.__value=o,n=!1}),O(e)}function f(e){return"__value"in e?e.__value:e.value}const k={expense:[{name:"Shopping",icon:"Cart",color:"#1e90ff",subs:["Supermarket","Home utilities"]},{name:"Car",icon:"Car",color:"#ff6347",subs:["Fuel","Insurance","Repairs"]},{name:"Home",icon:"Home",color:"#32cd32",subs:["Electricity","Generator","Maintenance","Water"]},{name:"Entertainment",icon:"Film",color:"#433d94ff",subs:["Dining Out","Movies","Outing"]},{name:"Personal",icon:"User",color:"#ffa500",subs:["Shopping","Selfcare"]},{name:"Gifts",icon:"Gift",color:"#8a2be2",subs:["Birthday","Wedding","Christmas"]},{name:"Healthcare",icon:"Heart",color:"#20b2aa",subs:["Doctor Visit","Pharmacy","Skincare","Health Insurance"]},{name:"Travel",icon:"Airplane",color:"#ff4500",subs:["Flight","Hotel","Car Rental"]}],income:[{name:"Salary",icon:"Salary",color:"#10b981"},{name:"Bonus",icon:"Bonus",color:"#3b82f6"},{name:"Gift",icon:"Gift",color:"#f59e0b"}]};function b(e){return k[e]??[]}const p=d([]),i=d(null);async function x(){const e=await fetch("/budgeting/api/accounts");if(!e.ok)throw new Error(await e.text());const t=await e.json();p.set(t),!s(i)&&t.length&&i.set(t[0])}async function A(e,t){const a=await fetch("/budgeting/api/accounts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,type:t})});if(!a.ok)throw new Error(await a.text());const n=await a.json();p.update(o=>[...o,n]),i.set(n)}function I(e){const t=s(p).find(a=>a.id===e)??null;i.set(t)}const c=d(b("expense"));async function j(){const e=s(i);if(!e)return;const t=await fetch(`/budgeting/api/user/categories?accountId=${encodeURIComponent(e.id)}`),a=t.ok?await t.json():[],n=b(e.type);c.set(a.length?a:n)}async function m(e){const t=s(i);t&&(await fetch(`/budgeting/api/user/categories?accountId=${encodeURIComponent(t.id)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),c.set(e))}async function F(e,t,a,n=[]){const o={name:e,icon:t,color:a,subs:n};await m([...s(c),o])}async function H(e,t){const a=s(c).map(r=>({...r,subs:Array.isArray(r.subs)?[...r.subs]:[]})),n=a.findIndex(r=>r.name===e);if(n===-1)return;const o=a[n].subs;o.includes(t)||(o.push(t),a[n].subs=o,await m(a))}const M=c,w="xpending:quick_templates";function P(){try{if(typeof window>"u"||typeof localStorage>"u")return[];const e=localStorage.getItem(w);return e?JSON.parse(e):[]}catch(e){return console.warn("Failed to read templates from localStorage",e),[]}}function q(e){try{if(typeof window>"u"||typeof localStorage>"u")return;localStorage.setItem(w,JSON.stringify(e))}catch(t){console.warn("Failed to save templates to localStorage",t)}}const u=d([]);if(typeof window<"u"){try{u.set(P())}catch(e){console.warn("Failed to initialize templates from storage",e)}u.subscribe(e=>q(e))}function D(e){const t=`${Date.now()}-${Math.random().toString(36).slice(2,9)}`;return u.update(a=>[{id:t,...e},...a]),t}function E(e){u.update(t=>t.filter(a=>a.id!==e))}function G(e,t){u.update(a=>a.map(n=>n.id===e?{...n,...t}:n))}async function J(e){const t=s(c),a=Array.isArray(t)&&t[0]&&t[0].name?t[0].name:"Misc",n={action:"create",date:new Date().toISOString(),amount:e.amount,category:e.category??a,subcategory:e.subcategory??null,description:e.description??null,account_id:e.account_id??null},o=await fetch("/budgeting/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok){const l=await o.text();throw new Error(l||`Failed to create transaction (${o.status})`)}return(await o.json()).transaction}const R=Object.freeze(Object.defineProperty({__proto__:null,accounts:p,addSubcategory:H,addTemplate:D,categories:c,createAccount:A,createCategory:F,createTransactionFromTemplate:J,currentAccount:i,loadAccounts:x,loadCategories:j,rawPrefs:M,removeTemplate:E,saveCategories:m,selectAccount:I,templates:u,updateTemplate:G},Symbol.toStringTag,{value:"Module"}));export{j as a,c as b,i as c,N as d,p as e,D as f,J as g,A as h,m as i,F as j,H as k,x as l,R as m,E as r,I as s,u as t,G as u};
