import{t as b,a as v}from"../chunks/CGPwJ-PK.js";import"../chunks/BqG6SY_L.js";import{p as x,a7 as k,a8 as $,s as p,N as w,t as S,g as r,a as T,m,b as o,c as C,r as F}from"../chunks/Dmv7ZRbC.js";import{e as N,s as P}from"../chunks/BUKcx96J.js";import{a as L}from"../chunks/C0n5Ga1D.js";import{i as z}from"../chunks/Du7F4BbZ.js";import{T as B}from"../chunks/DoGy20tW.js";async function M(a){const{data:{text:t}}=await B.recognize(a,"eng",{logger:e=>console.log("[OCR]",e)});return t}const O={name:"Spinneys",matches(a){const t=a.replace(/\s+/g,"").toLowerCase(),e=/spinneys/.test(t)||/sp1nne?ys/.test(t)||/spinney\$/.test(t),n=/rate\s*usd/i.test(a)&&/total\s*usd/i.test(a);return e||n},extractTotal(a){const t=a.match(/total\s*usd[^\d\-]*([0-9][0-9.,]*)/i);if(!t)return null;const e=t[1].replace(/\s+/g,"").replace(/,(?=\d{2}$)/,".").replace(/,/g,""),n=parseFloat(e);return isFinite(n)?n:null}},R=[O];var U=b('<h2>Scan a receipt</h2> <input type="file" accept="image/*"> <button>Scan</button> <p> </p>',1);function I(a,t){x(t,!1);let e=m(null),n=m(null),c=m("");async function h(){if(!r(n)){o(c,"Pick an image first");return}o(c,"Scanning…");try{const s=await M(r(n)),i=R.find(y=>y.matches(s)),l=i==null?void 0:i.extractTotal(s);o(c,i?`Parsed ${i.name} – $${(l==null?void 0:l.toFixed(2))??"total not found"}`:"No parser matched this receipt")}catch(s){console.error(s),o(c,"❌ Could not read image (format or resolution problem)")}}k(()=>r(e),()=>{var s;o(n,((s=r(e))==null?void 0:s[0])??null)}),$(),z();var f=U(),u=p(w(f),2),g=p(u,2),d=p(g,2),_=C(d,!0);F(d),S(()=>P(_,r(c))),L(u,()=>r(e),s=>o(e,s)),N("click",g,h),v(a,f),T()}export{I as component};
