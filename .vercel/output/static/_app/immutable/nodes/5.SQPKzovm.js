import"../chunks/Bzak7iHL.js";import"../chunks/B8zN5-cI.js";import{aa as Ze,ay as Qe,az as Xe,b as xe,ad as re,f as er,ab as rr,a7 as Y,a as tr,ac as nr,af as te,ah as K,ae as or,ag as ar}from"../chunks/BVWwdZHL.js";import{e as ir,s as sr}from"../chunks/B8z2uk3R.js";import{a as cr}from"../chunks/Dtqw5nwn.js";import{i as ur}from"../chunks/DiBsknOO.js";import{g as lr}from"../chunks/gnU0ypJ3.js";var ne={exports:{}},Oe;function fr(){return Oe||(Oe=1,(function(i){var o=(function(n){var c=Object.prototype,s=c.hasOwnProperty,d=Object.defineProperty||function(r,e,t){r[e]=t.value},p,w=typeof Symbol=="function"?Symbol:{},I=w.iterator||"@@iterator",C=w.asyncIterator||"@@asyncIterator",M=w.toStringTag||"@@toStringTag";function v(r,e,t){return Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{v({},"")}catch{v=function(e,t,u){return e[t]=u}}function O(r,e,t,u){var a=e&&e.prototype instanceof y?e:y,h=Object.create(a.prototype),E=new V(u||[]);return d(h,"_invoke",{value:x(r,t,E)}),h}n.wrap=O;function T(r,e,t){try{return{type:"normal",arg:r.call(e,t)}}catch(u){return{type:"throw",arg:u}}}var j="suspendedStart",m="suspendedYield",L="executing",U="completed",S={};function y(){}function k(){}function A(){}var B={};v(B,I,function(){return this});var F=Object.getPrototypeOf,W=F&&F(F(Z([])));W&&W!==c&&s.call(W,I)&&(B=W);var G=A.prototype=y.prototype=Object.create(B);k.prototype=A,d(G,"constructor",{value:A,configurable:!0}),d(A,"constructor",{value:k,configurable:!0}),k.displayName=v(A,M,"GeneratorFunction");function H(r){["next","throw","return"].forEach(function(e){v(r,e,function(t){return this._invoke(e,t)})})}n.isGeneratorFunction=function(r){var e=typeof r=="function"&&r.constructor;return e?e===k||(e.displayName||e.name)==="GeneratorFunction":!1},n.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,A):(r.__proto__=A,v(r,M,"GeneratorFunction")),r.prototype=Object.create(G),r},n.awrap=function(r){return{__await:r}};function z(r,e){function t(h,E,R,_){var b=T(r[h],r,E);if(b.type==="throw")_(b.arg);else{var l=b.arg,f=l.value;return f&&typeof f=="object"&&s.call(f,"__await")?e.resolve(f.__await).then(function(g){t("next",g,R,_)},function(g){t("throw",g,R,_)}):e.resolve(f).then(function(g){l.value=g,R(l)},function(g){return t("throw",g,R,_)})}}var u;function a(h,E){function R(){return new e(function(_,b){t(h,E,_,b)})}return u=u?u.then(R,R):R()}d(this,"_invoke",{value:a})}H(z.prototype),v(z.prototype,C,function(){return this}),n.AsyncIterator=z,n.async=function(r,e,t,u,a){a===void 0&&(a=Promise);var h=new z(O(r,e,t,u),a);return n.isGeneratorFunction(e)?h:h.next().then(function(E){return E.done?E.value:h.next()})};function x(r,e,t){var u=j;return function(h,E){if(u===L)throw new Error("Generator is already running");if(u===U){if(h==="throw")throw E;return X()}for(t.method=h,t.arg=E;;){var R=t.delegate;if(R){var _=$(R,t);if(_){if(_===S)continue;return _}}if(t.method==="next")t.sent=t._sent=t.arg;else if(t.method==="throw"){if(u===j)throw u=U,t.arg;t.dispatchException(t.arg)}else t.method==="return"&&t.abrupt("return",t.arg);u=L;var b=T(r,e,t);if(b.type==="normal"){if(u=t.done?U:m,b.arg===S)continue;return{value:b.arg,done:t.done}}else b.type==="throw"&&(u=U,t.method="throw",t.arg=b.arg)}}}function $(r,e){var t=e.method,u=r.iterator[t];if(u===p)return e.delegate=null,t==="throw"&&r.iterator.return&&(e.method="return",e.arg=p,$(r,e),e.method==="throw")||t!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+t+"' method")),S;var a=T(u,r.iterator,e.arg);if(a.type==="throw")return e.method="throw",e.arg=a.arg,e.delegate=null,S;var h=a.arg;if(!h)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,S;if(h.done)e[r.resultName]=h.value,e.next=r.nextLoc,e.method!=="return"&&(e.method="next",e.arg=p);else return h;return e.delegate=null,S}H(G),v(G,M,"Generator"),v(G,I,function(){return this}),v(G,"toString",function(){return"[object Generator]"});function N(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function J(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function V(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(N,this),this.reset(!0)}n.keys=function(r){var e=Object(r),t=[];for(var u in e)t.push(u);return t.reverse(),function a(){for(;t.length;){var h=t.pop();if(h in e)return a.value=h,a.done=!1,a}return a.done=!0,a}};function Z(r){if(r){var e=r[I];if(e)return e.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var t=-1,u=function a(){for(;++t<r.length;)if(s.call(r,t))return a.value=r[t],a.done=!1,a;return a.value=p,a.done=!0,a};return u.next=u}}return{next:X}}n.values=Z;function X(){return{value:p,done:!0}}return V.prototype={constructor:V,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=p,this.done=!1,this.delegate=null,this.method="next",this.arg=p,this.tryEntries.forEach(J),!r)for(var e in this)e.charAt(0)==="t"&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=p)},stop:function(){this.done=!0;var r=this.tryEntries[0],e=r.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function t(_,b){return h.type="throw",h.arg=r,e.next=_,b&&(e.method="next",e.arg=p),!!b}for(var u=this.tryEntries.length-1;u>=0;--u){var a=this.tryEntries[u],h=a.completion;if(a.tryLoc==="root")return t("end");if(a.tryLoc<=this.prev){var E=s.call(a,"catchLoc"),R=s.call(a,"finallyLoc");if(E&&R){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(E){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else if(R){if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,e){for(var t=this.tryEntries.length-1;t>=0;--t){var u=this.tryEntries[t];if(u.tryLoc<=this.prev&&s.call(u,"finallyLoc")&&this.prev<u.finallyLoc){var a=u;break}}a&&(r==="break"||r==="continue")&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var h=a?a.completion:{};return h.type=r,h.arg=e,a?(this.method="next",this.next=a.finallyLoc,S):this.complete(h)},complete:function(r,e){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&e&&(this.next=e),S},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===r)return this.complete(t.completion,t.afterLoc),J(t),S}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===r){var u=t.completion;if(u.type==="throw"){var a=u.arg;J(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,t){return this.delegate={iterator:Z(r),resultName:e,nextLoc:t},this.method==="next"&&(this.arg=p),S}},n})(i.exports);try{regeneratorRuntime=o}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}})(ne)),ne.exports}var oe,ke;function Re(){return ke||(ke=1,oe=(i,o)=>`${i}-${o}-${Math.random().toString(16).slice(3,8)}`),oe}var ae,_e;function Ke(){if(_e)return ae;_e=1;const i=Re();let o=0;return ae=({id:n,action:c,payload:s={}})=>{let d=n;return typeof d>"u"&&(d=i("Job",o),o+=1),{id:d,action:c,payload:s}},ae}var Q={},Te;function be(){if(Te)return Q;Te=1;let i=!1;return Q.logging=i,Q.setLogging=o=>{i=o},Q.log=(...o)=>i?console.log.apply(this,o):null,Q}var ie,Ae;function dr(){if(Ae)return ie;Ae=1;const i=Ke(),{log:o}=be(),n=Re();let c=0;return ie=()=>{const s=n("Scheduler",c),d={},p={};let w=[];c+=1;const I=()=>w.length,C=()=>Object.keys(d).length,M=()=>{if(w.length!==0){const m=Object.keys(d);for(let L=0;L<m.length;L+=1)if(typeof p[m[L]]>"u"){w[0](d[m[L]]);break}}},v=(m,L)=>new Promise((U,S)=>{const y=i({action:m,payload:L});w.push(async k=>{w.shift(),p[k.id]=y;try{U(await k[m].apply(this,[...L,y.id]))}catch(A){S(A)}finally{delete p[k.id],M()}}),o(`[${s}]: Add ${y.id} to JobQueue`),o(`[${s}]: JobQueue length=${w.length}`),M()});return{addWorker:m=>(d[m.id]=m,o(`[${s}]: Add ${m.id}`),o(`[${s}]: Number of workers=${C()}`),M(),m.id),addJob:async(m,...L)=>{if(C()===0)throw Error(`[${s}]: You need to have at least one worker before adding jobs`);return v(m,L)},terminate:async()=>{Object.keys(d).forEach(async m=>{await d[m].terminate()}),w=[]},getQueueLen:I,getNumWorkers:C}},ie}function hr(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var se,Ne;function pr(){return Ne||(Ne=1,se=i=>{const o={};return typeof WorkerGlobalScope<"u"?o.type="webworker":typeof document=="object"?o.type="browser":typeof process=="object"&&typeof hr=="function"&&(o.type="node"),typeof i>"u"?o:o[i]}),se}var ce,qe;function vr(){if(qe)return ce;qe=1;const o=pr()("type")==="browser"?n=>new URL(n,window.location.href).href:n=>n;return ce=n=>{const c={...n};return["corePath","workerPath","langPath"].forEach(s=>{n[s]&&(c[s]=o(c[s]))}),c},ce}var ue,Pe;function He(){return Pe||(Pe=1,ue={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}),ue}const gr="6.0.1",mr={version:gr};var le,Ie;function yr(){return Ie||(Ie=1,le={workerBlobURL:!0,logger:()=>{}}),le}var fe,Ce;function wr(){if(Ce)return fe;Ce=1;const i=mr.version;return fe={...yr(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${i}/dist/worker.min.js`},fe}var de,Me;function Lr(){return Me||(Me=1,de=({workerPath:i,workerBlobURL:o})=>{let n;if(Blob&&URL&&o){const c=new Blob([`importScripts("${i}");`],{type:"application/javascript"});n=new Worker(URL.createObjectURL(c))}else n=new Worker(i);return n}),de}var he,Ge;function Sr(){return Ge||(Ge=1,he=i=>{i.terminate()}),he}var pe,$e;function Er(){return $e||($e=1,pe=(i,o)=>{i.onmessage=({data:n})=>{o(n)}}),pe}var ve,De;function Rr(){return De||(De=1,ve=async(i,o)=>{i.postMessage(o)}),ve}var ge,Ue;function br(){if(Ue)return ge;Ue=1;const i=n=>new Promise((c,s)=>{const d=new FileReader;d.onload=()=>{c(d.result)},d.onerror=({target:{error:{code:p}}})=>{s(Error(`File could not be read! Code=${p}`))},d.readAsArrayBuffer(n)}),o=async n=>{let c=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?c=atob(n.split(",")[1]).split("").map(s=>s.charCodeAt(0)):c=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(c=await o(n.src)),n.tagName==="VIDEO"&&(c=await o(n.poster)),n.tagName==="CANVAS"&&await new Promise(s=>{n.toBlob(async d=>{c=await i(d),s()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){const s=await n.convertToBlob();c=await i(s)}else(n instanceof File||n instanceof Blob)&&(c=await i(n));return new Uint8Array(c)};return ge=o,ge}var me,We;function Or(){if(We)return me;We=1;const i=wr(),o=Lr(),n=Sr(),c=Er(),s=Rr(),d=br();return me={defaultOptions:i,spawnWorker:o,terminateWorker:n,onMessage:c,send:s,loadImage:d},me}var ye,je;function Je(){if(je)return ye;je=1;const i=vr(),o=Ke(),{log:n}=be(),c=Re(),s=He(),{defaultOptions:d,spawnWorker:p,terminateWorker:w,onMessage:I,loadImage:C,send:M}=Or();let v=0;return ye=async(O="eng",T=s.LSTM_ONLY,j={},m={})=>{const L=c("Worker",v),{logger:U,errorHandler:S,...y}=i({...d,...j}),k={},A=typeof O=="string"?O.split("+"):O;let B=T,F=m;const W=[s.DEFAULT,s.LSTM_ONLY].includes(T)&&!y.legacyCore;let G,H;const z=new Promise((l,f)=>{H=l,G=f}),x=l=>{G(l.message)};let $=p(y);$.onerror=x,v+=1;const N=({id:l,action:f,payload:g})=>new Promise((q,P)=>{n(`[${L}]: Start ${l}, action=${f}`);const D=`${f}-${l}`;k[D]={resolve:q,reject:P},M($,{workerId:L,jobId:l,action:f,payload:g})}),J=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),V=l=>N(o({id:l,action:"load",payload:{options:{lstmOnly:W,corePath:y.corePath,logging:y.logging}}})),Z=(l,f,g)=>N(o({id:g,action:"FS",payload:{method:"writeFile",args:[l,f]}})),X=(l,f)=>N(o({id:f,action:"FS",payload:{method:"readFile",args:[l,{encoding:"utf8"}]}})),r=(l,f)=>N(o({id:f,action:"FS",payload:{method:"unlink",args:[l]}})),e=(l,f,g)=>N(o({id:g,action:"FS",payload:{method:l,args:f}})),t=(l,f)=>N(o({id:f,action:"loadLanguage",payload:{langs:l,options:{langPath:y.langPath,dataPath:y.dataPath,cachePath:y.cachePath,cacheMethod:y.cacheMethod,gzip:y.gzip,lstmOnly:[s.DEFAULT,s.LSTM_ONLY].includes(B)&&!y.legacyLang}}})),u=(l,f,g,q)=>N(o({id:q,action:"initialize",payload:{langs:l,oem:f,config:g}})),a=(l="eng",f,g,q)=>{if(W&&[s.TESSERACT_ONLY,s.TESSERACT_LSTM_COMBINED].includes(f))throw Error("Legacy model requested but code missing.");const P=f||B;B=P;const D=g||F;F=D;const ee=(typeof l=="string"?l.split("+"):l).filter(Ve=>!A.includes(Ve));return A.push(...ee),ee.length>0?t(ee,q).then(()=>u(l,P,D,q)):u(l,P,D,q)},h=(l={},f)=>N(o({id:f,action:"setParameters",payload:{params:l}})),E=async(l,f={},g={text:!0},q)=>N(o({id:q,action:"recognize",payload:{image:await C(l),options:f,output:g}})),R=async(l,f)=>{if(W)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return N(o({id:f,action:"detect",payload:{image:await C(l)}}))},_=async()=>($!==null&&(w($),$=null),Promise.resolve());I($,({workerId:l,jobId:f,status:g,action:q,data:P})=>{const D=`${q}-${f}`;if(g==="resolve")n(`[${l}]: Complete ${f}`),k[D].resolve({jobId:f,data:P}),delete k[D];else if(g==="reject")if(k[D].reject(P),delete k[D],q==="load"&&G(P),S)S(P);else throw Error(P);else g==="progress"&&U({...P,userJobId:f})});const b={id:L,worker:$,load:J,writeText:Z,readText:X,removeFile:r,FS:e,reinitialize:a,setParameters:h,recognize:E,detect:R,terminate:_};return V().then(()=>t(O)).then(()=>u(O,T,m)).then(()=>H(b)).catch(()=>{}),z},ye}var we,Be;function kr(){if(Be)return we;Be=1;const i=Je();return we={recognize:async(c,s,d)=>{const p=await i(s,1,d);return p.recognize(c).finally(async()=>{await p.terminate()})},detect:async(c,s)=>{const d=await i("osd",0,s);return d.detect(c).finally(async()=>{await d.terminate()})}},we}var Le,Fe;function _r(){return Fe||(Fe=1,Le={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}),Le}var Se,ze;function Tr(){return ze||(ze=1,Se={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}),Se}var Ee,Ye;function Ar(){if(Ye)return Ee;Ye=1,fr();const i=dr(),o=Je(),n=kr(),c=_r(),s=He(),d=Tr(),{setLogging:p}=be();return Ee={languages:c,OEM:s,PSM:d,createScheduler:i,createWorker:o,setLogging:p,...n},Ee}var Nr=Ar();const qr=lr(Nr);async function Pr(i){const{data:{text:o}}=await qr.recognize(i,"eng",{logger:n=>console.log("[OCR]",n)});return o}const Ir={name:"Spinneys",matches(i){const o=i.replace(/\s+/g,"").toLowerCase(),n=/spinneys/.test(o)||/sp1nne?ys/.test(o)||/spinney\$/.test(o),c=/rate\s*usd/i.test(i)&&/total\s*usd/i.test(i);return n||c},extractTotal(i){const o=i.match(/total\s*usd[^\d\-]*([0-9][0-9.,]*)/i);if(!o)return null;const n=o[1].replace(/\s+/g,"").replace(/,(?=\d{2}$)/,".").replace(/,/g,""),c=parseFloat(n);return isFinite(c)?c:null}},Cr=[Ir];var Mr=xe('<h2>Scan a receipt</h2> <input type="file" accept="image/*" capture="environment"/> <button>Scan</button> <p> </p>',1);function zr(i,o){Ze(o,!1);let n=te(null),c=te(null),s=te("");async function d(){if(!Y(c)){K(s,"Pick an image first");return}K(s,"Scanning…");try{const v=await Pr(Y(c)),O=Cr.find(j=>j.matches(v)),T=O==null?void 0:O.extractTotal(v);K(s,O?`Parsed ${O.name} – $${(T==null?void 0:T.toFixed(2))??"total not found"}`:"No parser matched this receipt")}catch(v){console.error(v),K(s,"❌ Could not read image (format or resolution problem)")}}Qe(()=>Y(n),()=>{var v;K(c,((v=Y(n))==null?void 0:v[0])??null)}),Xe(),ur();var p=Mr(),w=re(er(p),2),I=re(w,2),C=re(I,2),M=or(C,!0);ar(C),rr(()=>sr(M,Y(s))),cr(w,()=>Y(n),v=>K(n,v)),ir("click",I,d),tr(i,p),nr()}export{zr as component};
